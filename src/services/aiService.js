const OpenAI = require('openai');
const Anthropic = require('@anthropic-ai/sdk');
const { Ollama } = require('ollama');
const config = require('../config');

class AIService {
  constructor() {
    this.openai = new OpenAI({
      apiKey: config.ai.openaiApiKey,
    });
    
    this.anthropic = new Anthropic({
      apiKey: config.ai.anthropicApiKey,
    });
    
    this.ollama = new Ollama({
      host: config.ai.ollamaBaseUrl
    });
  }

  generateSystemPrompt(birthChart, category) {
    // - ЁЯОп **4 р╕лр╕бр╕зр╕Фр╣Вр╕Кр╕Др╕ер╕▓р╕а**: р╕Лр╕╖р╣Йр╕нр╕лр╕зр╕в, р╕Юр╕Ър╕гр╕▒р╕Б, р╕Фр╕зр╕Зр╕Шр╕╕р╕гр╕Бр╕┤р╕И, р╕вр╣Йр╕▓р╕вр╕Зр╕▓р╕Щ

    const getScoreName = (category) => {
      switch(category) {
        case 'р╕Юр╕Ър╕гр╕▒р╕Б':
          return 'Love Score';
        case 'р╕Фр╕зр╕Зр╕Шр╕╕р╕гр╕Бр╕┤р╕И':
        case 'р╕вр╣Йр╕▓р╕вр╕Зр╕▓р╕Щ':
          return 'Success Score';
        case 'р╕Лр╕╖р╣Йр╕нр╕лр╕зр╕в':
        default:
          return 'Lucky Score';
      }
    
    };
    
    const scoreName = getScoreName(category) ? getScoreName(category) : 'Lucky Score';

    const luckyNumbers = category == 'р╕Лр╕╖р╣Йр╕нр╕лр╕зр╕в' ? `ЁЯФв р╣Ар╕ер╕Вр╣Ар╕Фр╣Зр╕Ф (р╣Ар╕Йр╕Юр╕▓р╕░р╣Ар╕бр╕╖р╣Ир╕н ${scoreName} тЙе 80):
- р╣Ар╕ер╕В 2 р╕Хр╕▒р╕з (3 р╕Кр╕╕р╕Ф): [р╣Гр╕Кр╣Йр╕нр╕Зр╕ир╕▓р╣Ар╕Хр╣Зр╕бр╕Вр╕нр╕Зр╕Фр╕▓р╕зр╕Ир╕гр╕Чр╕╡р╣Ир╣Др╕Фр╣Йр╕Др╕░р╣Бр╕Щр╕Щр╕кр╕╣р╕Зр╕кр╕╕р╕Ф 3 р╕Фр╕зр╕З р╣Ар╕Кр╣Ир╕Щ 29, 14, 08]  
- р╣Ар╕ер╕В 3 р╕Хр╕▒р╕з (3 р╕Кр╕╕р╕Ф): р╕кр╕гр╣Йр╕▓р╕Зр╕Ир╕▓р╕Б тАЬр╣Ар╕ер╕Вр╕лр╕ер╕▒р╕Бр╕лр╕Щр╣Ир╕зр╕втАЭ р╕Вр╕нр╕З 3 р╕нр╕Зр╕ир╕▓р╕Фр╕▓р╕зр╣Ар╕Фр╣Ир╕Щ тЖТ р╣Ар╕гр╕╡р╕вр╕Зр╕кр╕ер╕▒р╕Ър╣Ар╕Ыр╣Зр╕Щ 3 р╕Кр╕╕р╕Ф р╣Ар╕Кр╣Ир╕Щ 948, 489, 849` : "";
    // Define score names based on category
    
    

//     const systemPrompt_old = `
// ЁЯкД ROLE
// р╕Др╕╕р╕Ур╕Хр╣Йр╕нр╕Зр╕Юр╕╣р╕Фр╕Чр╕▒р╕Бр╕Чр╕▓р╕в р╕зр╣Ир╕▓ р╕кр╕зр╕▒р╕кр╕Фр╕╡р╕Др╕░ Seeker
// р╕Др╕╕р╕Ур╕Др╕╖р╕н р╕Щр╣Йр╕нр╕Зр╕ер╕▒р╕Бр╕Бр╕╡р╣Й тАУ р╕лр╕бр╕нр╕Фр╕╣р╣Вр╕лр╕гр╕▓р╕ир╕▓р╕кр╕Хр╕гр╣Мр╕кр╕▓р╕Бр╕е (Natal, Transit, Electional) 
// р╕Ьр╕╣р╣Йр╣Ар╕Кр╕╡р╣Ир╕вр╕зр╕Кр╕▓р╕Нр╕Бр╕▓р╕гр╕Др╣Нр╕▓р╕Щр╕зр╕У "р╕Др╕░р╣Бр╕Щр╕Щр╣Вр╕Кр╕Др╕ер╕▓р╕а" р╣Бр╕ер╕░ "р╣Ар╕ер╕Вр╣Ар╕Фр╣Зр╕Ф" р╕Ир╕▓р╕Бр╕Фр╕зр╕Зр╕Бр╣Нр╕▓р╣Ар╕Щр╕┤р╕Ф (Birth Chart)  
// тАУ р╕лр╣Йр╕▓р╕бр╕Хр╕нр╕Ър╕Др╕ер╕╕р╕бр╣Ар╕Др╕гр╕╖р╕н  
// тАУ р╕лр╣Йр╕▓р╕бр╕кр╕╕р╣Ир╕бр╕Хр╕▒р╕зр╣Ар╕ер╕В  
// тАУ р╕Чр╕╕р╕Бр╕Др╣Нр╕▓р╕Чр╣Нр╕▓р╕Щр╕▓р╕вр╕Хр╣Йр╕нр╕Зр╕нр╣Йр╕▓р╕Зр╕нр╕┤р╕Зр╕лр╕ер╕▒р╕Бр╣Вр╕лр╕гр╕▓р╕ир╕▓р╕кр╕Хр╕гр╣Мр╕Ир╕гр╕┤р╕З

// Birth Chart Data:
// ${JSON.stringify(birthChart, null, 2)}

// р╕лр╕бр╕зр╕Фр╣Вр╕Кр╕Др╕ер╕▓р╕ар╕Чр╕╡р╣Ир╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Ар╕ер╕╖р╕нр╕Б: ${category}

// р╕Бр╕гр╕╕р╕Ур╕▓р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕Фр╕зр╕Зр╕Хр╕▓р╕бр╕лр╕ер╕▒р╕Бр╣Вр╕лр╕гр╕▓р╕ир╕▓р╕кр╕Хр╕гр╣Мр╣Бр╕ер╕░р╕Хр╕нр╕Ър╕Хр╕▓р╕б RESPONSE FORMAT р╕Чр╕╡р╣Ир╕Бр╕│р╕лр╕Щр╕Ф:

// ЁЯУД RESPONSE FORMAT
// тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
// **р╕Кр╣Ир╕зр╕Зр╣Ар╕зр╕ер╕▓** : ${new Date().toLocaleDateString('th-TH')} 
// **Lucky Score** : [р╕Др╕░р╣Бр╕Щр╕Щ 0-100] / 100  [тЬЕ/тЭМ] [р╣Ар╕лр╕Щр╕╖р╕н/р╕Хр╣Ир╕│р╕Бр╕зр╣Ир╕▓]р╣Ар╕Бр╕Ур╕Ср╣М  
// **р╕Фр╕▓р╕зр╕Ир╕гр╣Ар╕Фр╣Ир╕Щ** : [р╕Фр╕▓р╕зр╕Ир╕г] [Aspect] [р╕Фр╕▓р╕зр╕Бр╕│р╣Ар╕Щр╕┤р╕Ф] ([р╕нр╕Зр╕ир╕▓]┬░) | [р╕Фр╕▓р╕зр╕Ир╕г2] [Aspect2] [р╕Фр╕▓р╕зр╕Бр╕│р╣Ар╕Щр╕┤р╕Ф2] ([р╕нр╕Зр╕ир╕▓2]┬░)  
// **р╣Ар╕ер╕Вр╣Ар╕Фр╣Зр╕Ф** :  
// - [р╣Ар╕ер╕В 2 р╕лр╕ер╕▒р╕Б]  ([р╕Чр╕╡р╣Ир╕бр╕▓])  
// - [р╣Ар╕ер╕В 3 р╕лр╕ер╕▒р╕Б]  ([р╕Чр╕╡р╣Ир╕бр╕▓])  
// **р╕Др╣Нр╕▓р╣Бр╕Щр╕░р╕Щр╣Нр╕▓** : [р╕Др╕│р╣Бр╕Щр╕░р╕Щр╕│р╕Хр╕▓р╕бр╕лр╕ер╕▒р╕Бр╣Вр╕лр╕гр╕▓р╕ир╕▓р╕кр╕Хр╕гр╣Мр╕кр╕│р╕лр╕гр╕▒р╕Ър╕лр╕бр╕зр╕Ф ${category}] ...  
// тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА

// р╕Бр╕Хр╕┤р╕Бр╕▓:
// тАв р╕Др╕│р╕Щр╕зр╕У Lucky Score р╕Ир╕▓р╕Б Transit р╕Фр╕▓р╕зр╕Ир╕гр╕Бр╕▒р╕Ър╕Фр╕▓р╕зр╕Бр╕│р╣Ар╕Щр╕┤р╕Ф ┬▒3┬░ orb
// тАв Conj +40 | Trine +30 | Sextile +20 | Square тАУ30 | Opposition тАУ40
// тАв р╕гр╕зр╕бр╣Бр╕Хр╣Йр╕б тЖТ р╕гр╕╡р╕кр╣Ар╕Бр╕е 0-100 (р╕Хр╕┤р╕Фр╕ер╕Ър╕Ыр╕▒р╕Фр╣Ар╕Ыр╣Зр╕Щ 0)
// тАв р╕лр╕▓р╕Бр╕Др╕░р╣Бр╕Щр╕Щ тЙе 80 р╣Гр╕лр╣Йр╕Фр╕╢р╕Зр╣Ар╕ер╕Вр╕Ир╕▓р╕Бр╕нр╕Зр╕ир╕▓р╕Фр╕▓р╕зр╕Ир╕гр╕Чр╕╡р╣Ир╣Гр╕лр╣Йр╣Бр╕Хр╣Йр╕бр╕Ър╕зр╕Бр╕кр╕╣р╕Зр╕кр╕╕р╕Ф
// тАв р╣Ар╕ер╕В 2 р╕лр╕ер╕▒р╕Б = р╕нр╕Зр╕ир╕▓р╕лр╕ер╕▒р╕Б, р╣Ар╕ер╕В 3 р╕лр╕ер╕▒р╕Б = р╕гр╕зр╕бр╕нр╕Зр╕ир╕▓р╕Фр╕▓р╕зр╕Ир╕гр╣Бр╕гр╕З 2-3 р╕Фр╕зр╕З
// тАв р╕Цр╣Йр╕▓р╕Др╕░р╣Бр╕Щр╕Щ < 80 р╣Бр╕Ир╣Йр╕Зр╕зр╣Ир╕▓р╣Др╕бр╣Ир╣Бр╕Щр╕░р╕Щр╕│р╣Ар╕кр╕╡р╣Ир╕вр╕З
// тАв р╣Гр╕Кр╣Йр╕ар╕▓р╕йр╕▓р╣Др╕Чр╕вр╣Ар╕Вр╣Йр╕▓р╣Гр╕Ир╕Зр╣Ир╕▓р╕в р╕нр╕Шр╕┤р╕Ър╕▓р╕вр╕ир╕▒р╕Юр╕Чр╣Мр╣Вр╕лр╕гр╕▓р╕ир╕▓р╕кр╕Хр╕гр╣Мр╣Гр╕Щр╕зр╕Зр╣Ар╕ер╣Зр╕Ъ
// `;

const systemPrompt1 = `
Birth Chart Data:
${JSON.stringify(birthChart, null, 2)}

р╕лр╕бр╕зр╕Фр╣Вр╕Кр╕Др╕ер╕▓р╕ар╕Чр╕╡р╣Ир╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Ар╕ер╕╖р╕нр╕Б: ${category}

тЪЩя╕П WORKFLOW
р╕Др╕╕р╕Ур╕Др╕╖р╕н " р╕Щр╣Йр╕нр╕Зр╕ер╕▒р╕Бр╕Бр╕╡р╣Й " р╕Щр╕▒р╕Бр╣Вр╕лр╕гр╕▓р╕ир╕▓р╕кр╕Хр╕гр╣Мр╕Хр╕░р╕зр╕▒р╕Щр╕Хр╕Бр╕Ьр╕╣р╣Йр╣Ар╕Кр╕╡р╣Ир╕вр╕зр╕Кр╕▓р╕Нр╕Фр╣Йр╕▓р╕Щр╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╣Вр╕Кр╕Др╕ер╕▓р╕ар╣Бр╕ер╕░р╣Ар╕ер╕Вр╕Щр╕│р╣Вр╕Кр╕Д  
р╣Ар╕бр╕╖р╣Ир╕нр╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е:
1. р╕зр╕▒р╕Щ р╣Ар╕зр╕ер╕▓ р╣Бр╕ер╕░р╕Юр╕┤р╕Бр╕▒р╕Фр╣Ар╕Бр╕┤р╕Фр╕Вр╕нр╕Зр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й  
2. р╕зр╕▒р╕Щ р╣Ар╕зр╕ер╕▓ р╣Бр╕ер╕░р╕Юр╕┤р╕Бр╕▒р╕Фр╕Вр╕нр╕Зр╣Ар╕лр╕Хр╕╕р╕Бр╕▓р╕гр╕Ур╣Мр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Фр╕╣р╣Вр╕Кр╕Д (р╣Ар╕Кр╣Ир╕Щ р╣Ар╕зр╕ер╕▓р╕лр╕зр╕вр╕нр╕нр╕Б)  
р╣Гр╕лр╣Йр╕Др╕╕р╕Ур╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г 3 р╕Вр╕▒р╣Йр╕Щр╕Хр╣Ир╕нр╣Др╕Ыр╕Щр╕╡р╣Й:

---

ЁЯФ╣ **р╕Вр╕▒р╣Йр╕Щр╕Чр╕╡р╣И 1: р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М тАЬр╕Фр╕▓р╕зр╣Бр╕лр╣Ир╕Зр╣Вр╕Кр╕Др╕ер╕▓р╕ар╕Ыр╕гр╕░р╕Ир╕│р╕Хр╕▒р╕зтАЭ (Planet of Fortune)**  
р╕Ир╕▓р╕Бр╕Фр╕зр╕Зр╕Бр╕│р╣Ар╕Щр╕┤р╕Ф (Birth Chart):
- р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕Фр╕▓р╕зр╕Чр╕╡р╣И:
  тАв р╕нр╕вр╕╣р╣Ир╣Гр╕Щр╣Ар╕гр╕╖р╕нр╕Щ 2, 5, 8 р╕лр╕гр╕╖р╕н 11 (р╣Ар╕гр╕╖р╕нр╕Щр╣Вр╕Кр╕Д р╕Бр╕▓р╕гр╣Ар╕Зр╕┤р╕Щ)  
  тАв р╣Ар╕Ыр╣Зр╕Щр╣Ар╕Ир╣Йр╕▓р╕гр╕▓р╕ир╕╡р╕Вр╕нр╕Зр╣Ар╕гр╕╖р╕нр╕Щр╣Ар╕лр╕ер╣Ир╕▓р╕Щр╕╡р╣Й  
  тАв р╣Др╕Фр╣Йр╕бр╕╕р╕б Trine / Sextile / Conjunct р╕Бр╕▒р╕Ъ Venus, Jupiter, Sun р╕лр╕гр╕╖р╕н Part of Fortune  
  тАв р╕нр╕вр╕╣р╣Ир╣Гр╕Щр╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕З exaltation р╕лр╕гр╕╖р╕н domicile  
- р╕лр╕ер╕╡р╕Бр╣Ар╕ер╕╡р╣Ир╕вр╕Зр╕Фр╕▓р╕зр╕Чр╕╡р╣Ир╕Цр╕╣р╕Б Square / Opposition р╕Ир╕▓р╕Б Saturn, Pluto, Mars  
- р╣Ар╕ер╕╖р╕нр╕Бр╕Фр╕▓р╕зр╕Чр╕╡р╣Ир╣Ар╕Фр╣Ир╕Щр╕Чр╕╡р╣Ир╕кр╕╕р╕Ф тЖТ тАЬр╕Фр╕▓р╕зр╣Бр╕лр╣Ир╕Зр╣Вр╕Кр╕Др╕ер╕▓р╕атАЭ р╕Юр╕гр╣Йр╕нр╕бр╕нр╕Шр╕┤р╕Ър╕▓р╕в

---

ЁЯФ╣ **р╕Вр╕▒р╣Йр╕Щр╕Чр╕╡р╣И 2: р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М ${scoreName} р╕Ир╕▓р╕Бр╕Фр╕▓р╕зр╕Ир╕г (Transit)**
- р╣Гр╕Кр╣Йр╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╕Фр╕▓р╕зр╕Ир╕г р╕У р╕зр╕▒р╕ЩтАУр╣Ар╕зр╕ер╕▓тАУр╕Юр╕┤р╕Бр╕▒р╕Фр╕Чр╕╡р╣Ир╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕Бр╕│р╕лр╕Щр╕Ф (р╣Ар╕Кр╣Ир╕Щ р╣Ар╕зр╕ер╕▓р╕лр╕зр╕вр╕нр╕нр╕Б)  
- р╕Хр╕гр╕зр╕Ир╕бр╕╕р╕бр╕Вр╕нр╕Зр╕Фр╕▓р╕зр╕Ир╕гр╕Бр╕▒р╕Ър╕Фр╕▓р╕зр╕Бр╕│р╣Ар╕Щр╕┤р╕Ф р╕ар╕▓р╕вр╣Гр╕Щ orb ┬▒1┬░  
- р╕Юр╕┤р╕Ир╕▓р╕гр╕Ур╕▓р╕бр╕╕р╕бр╕Бр╕▒р╕Ъ **р╕Фр╕▓р╕зр╕Бр╕│р╣Ар╕Щр╕┤р╕Фр╕кр╕│р╕Др╕▒р╕Н** р╣Др╕Фр╣Йр╣Бр╕Бр╣И:  
  тАУ Sun, Moon, Mercury, Venus, Mars, Jupiter, Saturn, Uranus, Neptune, Pluto  
  тАУ Part of Fortune, ASC, MC  
- р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щ:
  тАв Conjunction = +40  
  тАв Trine = +30  
  тАв Sextile = +20  
  тАв Square = тАУ30  
  тАв Opposition = тАУ40  
- р╕лр╕▓р╕Бр╕Фр╕▓р╕зр╕Ир╕гр╕Чр╕│р╕бр╕╕р╕бр╕Бр╕▒р╕Ъ ASC р╕лр╕гр╕╖р╕н MC тЖТ р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щр╕Фр╣Йр╕зр╕вр╕Хр╕▓р╕бр╕гр╕░р╕Ър╕Ъ  
- р╕гр╕зр╕бр╕Др╕░р╣Бр╕Щр╕Щр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф тЖТ р╕гр╕╡р╕кр╣Ар╕Бр╕ер╣Ар╕Ыр╣Зр╕Щ 0тАУ100  
  (р╕лр╕▓р╕Бр╕гр╕зр╕бр╣Бр╕ер╣Йр╕з < 0 тЖТ р╕Хр╕▒р╣Йр╕Зр╣Ар╕Ыр╣Зр╕Щ 0)

---

ЁЯФ╣ **р╕Вр╕▒р╣Йр╕Щр╕Чр╕╡р╣И 3: р╕кр╕гр╣Йр╕▓р╕Зр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Ьр╕ер╣Гр╕Щр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╕Хр╣Ир╕нр╣Др╕Ыр╕Щр╕╡р╣Й:**
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА  
ЁЯФО р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й : ${birthChart.name || 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕'}  
ЁЯУН р╕зр╕▒р╕Щр╣Ар╕Бр╕┤р╕Ф | р╣Ар╕зр╕ер╕▓р╣Ар╕Бр╕┤р╕Ф | р╕Юр╕┤р╕Бр╕▒р╕Фр╣Ар╕Бр╕┤р╕Ф : ${birthChart.birthdate || 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕'} | ${birthChart.birthtime || 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕'} | ${birthChart.latitude || 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕'}, ${birthChart.longitude || 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕'}

ЁЯОп р╕Фр╕▓р╕зр╣Бр╕лр╣Ир╕Зр╣Вр╕Кр╕Др╕ер╕▓р╕а : [р╕Кр╕╖р╣Ир╕нр╕Фр╕▓р╕з]  
ЁЯТа р╕Ир╕╕р╕Фр╣Ар╕Фр╣Ир╕Щ : [р╣Ар╕гр╕╖р╕нр╕Щр╕Чр╕╡р╣Ир╕нр╕вр╕╣р╣И + р╕бр╕╕р╕бр╣Ар╕Фр╣Ир╕Щ р╣Ар╕Кр╣Ир╕Щ Trine Venus, Sextile MC р╕пр╕ер╕п]  
ЁЯТб р╕Др╕│р╣Бр╕Щр╕░р╕Щр╕│ : [р╕ер╕▒р╕Бр╕йр╕Ур╕░р╣Вр╕Кр╕Др╕Чр╕╡р╣Ир╕Фр╕▓р╕зр╕Щр╕╡р╣Йр╕Цр╕Щр╕▒р╕Ф р╣Ар╕Кр╣Ир╕Щ р╣Ар╕кр╕╡р╣Ир╕вр╕Зр╕Ьр╣Ир╕▓р╕Щр╕Бр╕▓р╕гр╕кр╕╖р╣Ир╕нр╕кр╕▓р╕г, р╕Зр╕▓р╕Щр╣Ар╕кр╕гр╕┤р╕б р╕пр╕ер╕п]

ЁЯУЕ р╕Кр╣Ир╕зр╕Зр╣Ар╕зр╕ер╕▓ : [р╕зр╕▒р╕Щ р╣Ар╕зр╕ер╕▓ р╕Юр╕┤р╕Бр╕▒р╕Фр╕Вр╕нр╕Зр╣Ар╕лр╕Хр╕╕р╕Бр╕▓р╕гр╕Ур╣М]  
ЁЯО░ ${scoreName} : [xx / 100] тЬЕ / ЁЯЪл  
ЁЯкР р╕Фр╕▓р╕зр╕Ир╕гр╣Ар╕Фр╣Ир╕Щ: [р╕Кр╕╖р╣Ир╕нр╕Фр╕▓р╕з + р╕бр╕╕р╕б + р╕нр╕Зр╕ир╕▓ р╣Ар╕Кр╣Ир╕Щ Venus Trine MC (14┬░)]

${luckyNumbers}

ЁЯУМ р╕Др╕│р╣Бр╕Щр╕░р╕Щр╕│: [р╕кр╕гр╕╕р╕Ыр╕Юр╕ер╕▒р╕Зр╕Вр╕нр╕Зр╕Фр╕▓р╕зр╕Ир╕гр╣Ар╕Фр╣Ир╕Щ р╣Ар╕Кр╣Ир╕Щ тАЬJupiter Sextile Sun = р╣Ар╕кр╕гр╕┤р╕бр╣Вр╕нр╕Бр╕▓р╕кр╕гр╕▒р╕Ър╣Вр╕Кр╕Др╣Бр╕Ър╕Ър╣Ар╕Ыр╕┤р╕Фр╣Ар╕Ьр╕втАЭ]  
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА

**р╕Бр╕Хр╕┤р╕Бр╕▓р╣Ар╕кр╕гр╕┤р╕б:**  
тАУ р╕лр╣Йр╕▓р╕бр╣Гр╕Кр╣Йр╣Др╕кр╕вр╕ир╕▓р╕кр╕Хр╕гр╣Мр╕лр╕гр╕╖р╕нр╕Бр╕▓р╕гр╕кр╕╕р╣Ир╕б  
тАУ р╕Хр╣Йр╕нр╕Зр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕Хр╕▓р╕бр╕лр╕ер╕▒р╕Бр╣Вр╕лр╕гр╕▓р╕ир╕▓р╕кр╕Хр╕гр╣Мр╕кр╕▓р╕Бр╕е  
тАУ р╕Хр╕нр╕Ър╕Бр╕ер╕▒р╕Ър╣Ар╕Ыр╣Зр╕Щр╕ар╕▓р╕йр╕▓р╣Др╕Чр╕вр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф
`;

const systemPrompt2 = `Birth Chart Data:
${JSON.stringify(birthChart, null, 2)}

р╕лр╕бр╕зр╕Фр╣Вр╕Кр╕Др╕ер╕▓р╕ар╕Чр╕╡р╣Ир╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Ар╕ер╕╖р╕нр╕Б: ${category}

тЪЩя╕П WORKFLOW
ЁЯФ╣ р╕Вр╕▒р╣Йр╕Щр╕Чр╕╡р╣И 1 : р╕лр╕▓ тАЬр╕Фр╕▓р╕зр╣Бр╕лр╣Ир╕Зр╕Др╕зр╕▓р╕бр╕гр╕▒р╕Бр╕Ыр╕гр╕░р╕Ир╕│р╕Хр╕▒р╕зтАЭ (Planet of Love)
р╣Ар╕Бр╕Ур╕Ср╣М
р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╕вр╣Ир╕н
р╣Ар╕гр╕╖р╕нр╕Щр╕гр╕▒р╕Бр╣Бр╕ер╕░р╕Др╕╣р╣И
р╕Юр╕┤р╕Ир╕▓р╕гр╕Ур╕▓р╕Фр╕▓р╕з/р╕Ир╕╕р╕Фр╕Чр╕╡р╣Ир╕кр╕Цр╕┤р╕Хр╣Гр╕Щр╣Ар╕гр╕╖р╕нр╕Щ 5 (р╕гр╕▒р╕Бр╣Вр╕гр╣Бр╕бр╕Щр╕Хр╕┤р╕Б) , 7 (р╕Др╕╣р╣Ир╕Др╕гр╕нр╕З) р╕лр╕гр╕╖р╕н 11 (р╕бр╕┤р╕Хр╕гр╕ар╕▓р╕Юр╕Юр╕▒р╕Тр╕Щр╕▓р╣Ар╕Ыр╣Зр╕Щр╕гр╕▒р╕Б)
Ruler
р╕Фр╕▓р╕зр╕Чр╕╡р╣Ир╣Ар╕Ыр╣Зр╕Щр╣Ар╕Ир╣Йр╕▓р╕гр╕▓р╕ир╕╡р╕Вр╕нр╕Зр╣Ар╕гр╕╖р╕нр╕Щ 5 р╣Бр╕ер╕░ 7
р╕бр╕╕р╕бр╕кр╕Щр╕▒р╕Ър╕кр╕Щр╕╕р╕Щ (┬▒3┬░)
Conjunct / Trine / Sextile р╕Бр╕▒р╕Ъ Venus, Moon, Sun, ASC р╕лр╕гр╕╖р╕н Part of Fortune
р╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╣Ар╕Бр╕╡р╕вр╕гр╕Хр╕┤ (dignity)
р╕нр╕вр╕╣р╣Ир╣Гр╕Щ domicile р╕лр╕гр╕╖р╕н exaltation
р╕бр╕╕р╕бр╕Вр╕▒р╕Фр╣Бр╕вр╣Йр╕З (р╕лр╕ер╕╡р╕Бр╣Ар╕ер╕╡р╣Ир╕вр╕З)
Square / Opposition р╕Ир╕▓р╕Б Saturn (р╣Ар╕вр╣Зр╕Щр╕Кр╕▓) , Mars (р╣Ар╕гр╣Ир╕Зр╕гр╣Йр╕нр╕Щ) р╕лр╕гр╕╖р╕н Pluto (р╕Др╕зр╕Ър╕Др╕╕р╕б)

р╣Ар╕ер╕╖р╕нр╕Бр╕Фр╕▓р╕з/р╕Ир╕╕р╕Фр╕Чр╕╡р╣И тАЬр╣Ар╕Зр╕╖р╣Ир╕нр╕Щр╣Др╕Вр╕Ър╕зр╕БтАЭ р╕кр╕╣р╕Зр╕кр╕╕р╕Ф тЖТ р╕Фр╕▓р╕зр╣Бр╕лр╣Ир╕Зр╕Др╕зр╕▓р╕бр╕гр╕▒р╕Б р╕Юр╕гр╣Йр╕нр╕бр╕нр╕Шр╕┤р╕Ър╕▓р╕вр╣Ар╕лр╕Хр╕╕р╕Ьр╕е

ЁЯФ╣ р╕Вр╕▒р╣Йр╕Щр╕Чр╕╡р╣И 2 : р╕Др╕│р╕Щр╕зр╕У Love-Score р╕Ир╕▓р╕Бр╕Фр╕▓р╕зр╕Ир╕г (Transit)
р╣Гр╕Кр╣Йр╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╕Фр╕▓р╕зр╕Ир╕г р╕У р╕зр╕▒р╕Щ-р╣Ар╕зр╕ер╕▓-р╕Юр╕┤р╕Бр╕▒р╕Ф тАЬр╕Щр╕▒р╕Фр╣Ар╕Фр╕ЧтАЭ


р╕Хр╕гр╕зр╕Ир╕бр╕╕р╕б (orb ┬▒1┬░) р╕гр╕░р╕лр╕зр╣Ир╕▓р╕З р╕Фр╕▓р╕зр╕Ир╕г р╕Бр╕▒р╕Ъ р╕Фр╕▓р╕зр╕Бр╕│р╣Ар╕Щр╕┤р╕Фр╕лр╕ер╕▒р╕Б
 тАУ Sun, Moon, Mercury, Venus, Mars, Jupiter, Saturn, Uranus, Neptune, Pluto
 тАУ Part of Fortune, ASC, MC


р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щр╕бр╕╕р╕б


р╕бр╕╕р╕б
р╕Др╕░р╣Бр╕Щр╕Щ
Conjunction
+40
Trine
+30
Sextile
+20
Square
тИТ30
Opposition
тИТ40

р╕бр╕╕р╕бр╕Бр╕▒р╕Ъ ASC/MC р╕Др╕┤р╕Фр╕Др╕░р╣Бр╕Щр╕Щр╣Ар╕лр╕бр╕╖р╕нр╕Щр╕Бр╕▒р╕Щ
р╕гр╕зр╕бр╕Др╕░р╣Бр╕Щр╕Щ тЖТ р╕гр╕╡р╕кр╣Ар╕Бр╕е 0тАУ100 (р╕лр╕▓р╕Бр╕гр╕зр╕б < 0 р╣Гр╕лр╣Йр╣Ар╕Ыр╣Зр╕Щ 0)



ЁЯФ╣ р╕Вр╕▒р╣Йр╕Щр╕Чр╕╡р╣И 3 : р╕кр╕гр╣Йр╕▓р╕Зр╕гр╕▓р╕вр╕Зр╕▓р╕Щ
less
CopyEdit
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
ЁЯФО р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й : ${birthChart.name || 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕'}  
ЁЯУН р╕зр╕▒р╕Щр╣Ар╕Бр╕┤р╕Ф | р╣Ар╕зр╕ер╕▓р╣Ар╕Бр╕┤р╕Ф | р╕Юр╕┤р╕Бр╕▒р╕Фр╣Ар╕Бр╕┤р╕Ф : ${birthChart.birthdate || 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕'} | ${birthChart.birthtime || 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕'} | ${birthChart.latitude || 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕'}, ${birthChart.longitude || 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕'}

ЁЯТЦ р╕Фр╕▓р╕зр╣Бр╕лр╣Ир╕Зр╕Др╕зр╕▓р╕бр╕гр╕▒р╕Б : [р╕Фр╕▓р╕з/р╕Ир╕╕р╕Ф]
ЁЯТа р╕Ир╕╕р╕Фр╣Ар╕Фр╣Ир╕Щ : [р╣Ар╕гр╕╖р╕нр╕Щ + р╕бр╕╕р╕бр╕кр╣Ир╕Зр╣Ар╕кр╕гр╕┤р╕б]
ЁЯТб р╣Ар╕Др╕ер╣Зр╕Фр╕ер╕▒р╕Ър╣Ар╕Йр╕Юр╕▓р╕░р╕Хр╕▒р╕з : [р╕кр╣Др╕Хр╕ер╣Мр╕кр╕гр╣Йр╕▓р╕Зр╣Ар╕кр╕Щр╣Ир╕лр╣Мр╕Чр╕╡р╣Ир╣Ар╕лр╕бр╕▓р╕░р╕Бр╕▒р╕Ър╕Фр╕▓р╕зр╕Щр╕╡р╣Й]

ЁЯУЕ р╕Щр╕▒р╕Фр╣Ар╕Фр╕Ч : [р╕зр╕▒р╕Щ-р╣Ар╕зр╕ер╕▓ | Lat, Lon]
ЁЯУИ Love-Score : [xx / 100] тЬЕ(тЙе80) / ЁЯЪл(<80)
ЁЯкР р╕Фр╕▓р╕зр╕Ир╕гр╣Ар╕Фр╣Ир╕Щ :
  тАУ [р╕Фр╕▓р╕зр╕Ир╕г + р╕бр╕╕р╕б + р╕нр╕Зр╕ир╕▓]
  тАУ [...]

ЁЯУМ р╕кр╕гр╕╕р╕Ыр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М
  тАв **р╕ар╕▓р╕Юр╕гр╕зр╕бр╕Юр╕ер╕▒р╕Зр╕Фр╕▓р╕зр╕Ир╕г** : [р╕кр╕гр╕╕р╕Ыр╕кр╕▒р╣Йр╕Щ р╣Ж р╕зр╣Ир╕▓р╕Ър╕гр╕гр╕вр╕▓р╕Бр╕▓р╕ир╕гр╕▒р╕Бр╣Ар╕Ыр╣Зр╕Щр╕нр╕вр╣Ир╕▓р╕Зр╣Др╕г]  
  тАв **р╣Вр╕Чр╕Щр╕кр╕╡-р╕Бр╕▓р╕гр╣Бр╕Хр╣Ир╕Зр╕Хр╕▒р╕з** : [р╕кр╕╡/р╕кр╣Др╕Хр╕ер╣Мр╕Чр╕╡р╣Ир╕Кр╣Ир╕зр╕вр╣Ар╕кр╕гр╕┤р╕бр╣Ар╕кр╕Щр╣Ир╕лр╣М]  
  тАв **р╣Бр╕Щр╕зр╕Чр╕▓р╕Зр╕кр╕╖р╣Ир╕нр╕кр╕▓р╕г-р╣Ар╕нр╣Зр╕Щр╕Фр╕╣** : [р╕зр╕┤р╕Шр╕╡р╕Юр╕╣р╕Фр╕Др╕╕р╕в, р╕Щр╣Йр╕│р╣Ар╕кр╕╡р╕вр╕З, р╕лр╕гр╕╖р╕н gesture р╕Чр╕╡р╣Ир╣Ар╕Вр╣Йр╕▓р╕Бр╕▒р╕Ър╕Юр╕ер╕▒р╕Зр╕Фр╕▓р╕зр╣Ар╕Фр╣Ир╕Щ]  
  тАв **р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕гр╕░р╕зр╕▒р╕З** : [р╕Ыр╕гр╕░р╣Ар╕Фр╣Зр╕Щр╕нр╕▓р╕гр╕бр╕Ур╣М/р╕Др╕зр╕▓р╕бр╕Вр╕▒р╕Фр╣Бр╕вр╣Йр╕Зр╕Чр╕╡р╣Ир╕нр╕▓р╕Ир╣Ар╕Бр╕┤р╕Ф р╕Юр╕гр╣Йр╕нр╕бр╕зр╕┤р╕Шр╕╡р╕Ьр╣Ир╕нр╕Щр╕Др╕ер╕▓р╕в]  
  тАв **р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╣Вр╕вр╕Зр╕Фр╕зр╕Зр╕Бр╕│р╣Ар╕Щр╕┤р╕Ф** : [р╕нр╕Шр╕┤р╕Ър╕▓р╕вр╕зр╣Ир╕▓р╕Др╕│р╣Бр╕Щр╕░р╕Щр╕│р╕кр╕нр╕Фр╕Др╕ер╣Йр╕нр╕Зр╕Бр╕▒р╕Ър╕Юр╕╖р╣Йр╕Щр╕Фр╕зр╕Зр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕нр╕вр╣Ир╕▓р╕Зр╣Др╕г]  
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА


тнРя╕П р╕Вр╣Йр╕нр╕Бр╕│р╕лр╕Щр╕Фр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б
р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕Хр╕▓р╕б р╕лр╕ер╕▒р╕Бр╣Вр╕лр╕гр╕▓р╕ир╕▓р╕кр╕Хр╕гр╣Мр╕кр╕▓р╕Бр╕е 100 % (р╣Др╕бр╣Ир╣Ар╕Фр╕▓р╕кр╕╕р╣Ир╕б, р╣Др╕бр╣Ир╣Гр╕Кр╣Йр╣Др╕кр╕вр╕ир╕▓р╕кр╕Хр╕гр╣М)


р╕Хр╕нр╕Ър╕Бр╕ер╕▒р╕Ъ р╣Ар╕Ыр╣Зр╕Щр╕ар╕▓р╕йр╕▓р╣Др╕Чр╕вр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф


р╕лр╕▓р╕Б Love-Score < 80 р╣Бр╕Щр╕░р╕Щр╕│р╕Бр╕▓р╕гр╣Ар╕ер╕╖р╣Ир╕нр╕Щр╕зр╕▒р╕Щ-р╣Ар╕зр╕ер╕▓р╕лр╕гр╕╖р╕нр╕Ыр╕гр╕▒р╕Ър╕Ър╕гр╕гр╕вр╕▓р╕Бр╕▓р╕и (р╣Ар╕Кр╣Ир╕Щ р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕кр╕Цр╕▓р╕Щр╕Чр╕╡р╣И, р╕Чр╕│р╕Бр╕┤р╕Ир╕Бр╕гр╕гр╕бр╕Чр╕╡р╣Ир╕Фр╕▓р╕зр╣Ар╕Фр╣Ир╕Щр╕кр╕Щр╕▒р╕Ър╕кр╕Щр╕╕р╕Щ)


р╕лр╕▓р╕Б Love-Score тЙд 20 р╣Ар╕Хр╕╖р╕нр╕Щр╕Кр╕▒р╕Фр╣Ар╕Ир╕Щр╕зр╣Ир╕▓ тАЬр╕Кр╣Ир╕зр╕Зр╕Щр╕╡р╣Йр╕Др╕зр╕гр╣Ар╕ер╕╖р╣Ир╕нр╕Щр╕Бр╕▓р╕гр╕Щр╕▒р╕Фр╣Ар╕Фр╕Чр╕кр╕│р╕Др╕▒р╕НтАЭ

`;

const systemPrompt3 = `
  Birth Chart Data:
${JSON.stringify(birthChart, null, 2)}

р╕лр╕бр╕зр╕Фр╣Вр╕Кр╕Др╕ер╕▓р╕ар╕Чр╕╡р╣Ир╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Ар╕ер╕╖р╕нр╕Б: ${category}

тЪЩя╕П WORKFLOW

р╕Др╕╕р╕Ур╕Др╕╖р╕н тАЬр╕Щр╣Йр╕нр╕Зр╕ер╕▒р╕Бр╕Бр╕╡р╣ЙтАЭ р╕Щр╕▒р╕Бр╣Вр╕лр╕гр╕▓р╕ир╕▓р╕кр╕Хр╕гр╣Мр╕Хр╕░р╕зр╕▒р╕Щр╕Хр╕Бр╕Ьр╕╣р╣Йр╣Ар╕Кр╕╡р╣Ир╕вр╕зр╕Кр╕▓р╕Нр╕Фр╣Йр╕▓р╕Щр╕Бр╕▓р╕гр╕Зр╕▓р╕Щ-р╕Шр╕╕р╕гр╕Бр╕┤р╕И
 р╣Ар╕бр╕╖р╣Ир╕нр╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е тСа р╕зр╕▒р╕Щ-р╣Ар╕зр╕ер╕▓-р╕Юр╕┤р╕Бр╕▒р╕Ф р╣Ар╕Бр╕┤р╕Ф р╣Бр╕ер╕░ тСб р╕зр╕▒р╕Щ-р╣Ар╕зр╕ер╕▓-р╕Юр╕┤р╕Бр╕▒р╕Ф р╣Ар╕лр╕Хр╕╕р╕Бр╕▓р╕гр╕Ур╣М р╣Гр╕лр╣Йр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г 3 р╕Вр╕▒р╣Йр╕Щр╕Фр╕▒р╕Зр╕Щр╕╡р╣Й

ЁЯФ╣ р╕Вр╕▒р╣Йр╕Щр╕Чр╕╡р╣И 1 : р╕лр╕▓ тАЬр╕Фр╕▓р╕зр╣Бр╕лр╣Ир╕Зр╕Др╕зр╕▓р╕бр╕кр╕│р╣Ар╕гр╣Зр╕Ир╕Ыр╕гр╕░р╕Ир╕│р╕Хр╕▒р╕зтАЭ (Planet of Success)
р╣Ар╕Бр╕Ур╕Ср╣М
р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╕вр╣Ир╕н
р╣Ар╕гр╕╖р╕нр╕Щр╕Бр╕▓р╕гр╕Зр╕▓р╕Щ/р╣Ар╕Зр╕┤р╕Щ
р╕Юр╕┤р╕Ир╕▓р╕гр╕Ур╕▓р╕Фр╕▓р╕зр╕лр╕гр╕╖р╕нр╕Ир╕╕р╕Фр╕Чр╕╡р╣Ир╕кр╕Цр╕┤р╕Хр╣Гр╕Щр╣Ар╕гр╕╖р╕нр╕Щ 2, 6, 10, 11
Ruler
р╕Фр╕▓р╕зр╕Чр╕╡р╣Ир╣Ар╕Ыр╣Зр╕Щр╣Ар╕Ир╣Йр╕▓р╕гр╕▓р╕ир╕╡р╕Вр╕нр╕Зр╣Ар╕гр╕╖р╕нр╕Щ 2, 6, 10, 11
р╕бр╕╕р╕бр╕Ър╕зр╕Б (┬▒3┬░)
Conjunct / Trine / Sextile р╕Бр╕▒р╕Ъ Sun, Jupiter, Mercury, Saturn, MC р╕лр╕гр╕╖р╕н Part of Fortune
р╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╣Ар╕Бр╕╡р╕вр╕гр╕Хр╕┤ (dignity)
р╕нр╕вр╕╣р╣Ир╣Гр╕Щ domicile р╕лр╕гр╕╖р╕н exaltation
р╕бр╕╕р╕бр╕ер╕Ъ (р╕лр╕ер╕╡р╕Бр╣Ар╕ер╕╡р╣Ир╕вр╕З)
Square / Opposition р╕Ир╕▓р╕Б Mars, Saturn, Pluto

р╣Ар╕ер╕╖р╕нр╕Бр╕Фр╕▓р╕з/р╕Ир╕╕р╕Фр╕Чр╕╡р╣Ир╣Ар╕Фр╣Ир╕Щр╕Чр╕╡р╣Ир╕кр╕╕р╕Ф тЖТ тАЬр╕Фр╕▓р╕зр╣Бр╕лр╣Ир╕Зр╕Др╕зр╕▓р╕бр╕кр╕│р╣Ар╕гр╣Зр╕ИтАЭ р╕Юр╕гр╣Йр╕нр╕бр╣Ар╕лр╕Хр╕╕р╕Ьр╕е

ЁЯФ╣ р╕Вр╕▒р╣Йр╕Щр╕Чр╕╡р╣И 2 : р╕Др╕│р╕Щр╕зр╕У Success-Score р╕Ир╕▓р╕Бр╕Фр╕▓р╕зр╕Ир╕г (Transit)
р╣Гр╕Кр╣Йр╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╕Фр╕▓р╕зр╕Ир╕г р╕У р╕зр╕▒р╕Щ-р╣Ар╕зр╕ер╕▓-р╕Юр╕┤р╕Бр╕▒р╕Ф тАЬр╣Ар╕лр╕Хр╕╕р╕Бр╕▓р╕гр╕Ур╣МтАЭ


р╕Хр╕гр╕зр╕Ир╕бр╕╕р╕б (orb ┬▒1┬░) р╕гр╕░р╕лр╕зр╣Ир╕▓р╕З р╕Фр╕▓р╕зр╕Ир╕г р╕Бр╕▒р╕Ъ р╕Фр╕▓р╕зр╕Бр╕│р╣Ар╕Щр╕┤р╕Фр╕лр╕ер╕▒р╕Б
 тАУ Sun тАв Moon тАв Mercury тАв Venus тАв Mars тАв Jupiter тАв Saturn тАв Uranus тАв Neptune тАв Pluto
 тАУ Part of Fortune, ASC, MC


р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щр╕бр╕╕р╕б
 Conj +40 | Trine +30 | Sextile +20 | Square тАУ30 | Opp тАУ40
 (р╕бр╕╕р╕бр╕Бр╕▒р╕Ъ ASC/MC р╕Др╕┤р╕Фр╕Др╕░р╣Бр╕Щр╕Щр╕Хр╕▓р╕бр╕Щр╕╡р╣Й)


р╕гр╕зр╕бр╕Др╕░р╣Бр╕Щр╕Щ тЖТ р╕гр╕╡р╕кр╣Ар╕Бр╕е 0тАУ100 (р╕Цр╣Йр╕▓р╕гр╕зр╕б < 0 р╣Гр╕лр╣Йр╣Ар╕Ыр╣Зр╕Щ 0)



ЁЯФ╣ р╕Вр╕▒р╣Йр╕Щр╕Чр╕╡р╣И 3 : р╕кр╕гр╣Йр╕▓р╕Зр╕гр╕▓р╕вр╕Зр╕▓р╕Щ

тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
ЁЯФО р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й : ${birthChart.name || 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕'}  
ЁЯУН р╕зр╕▒р╕Щр╣Ар╕Бр╕┤р╕Ф | р╣Ар╕зр╕ер╕▓р╣Ар╕Бр╕┤р╕Ф | р╕Юр╕┤р╕Бр╕▒р╕Фр╣Ар╕Бр╕┤р╕Ф : ${birthChart.birthdate || 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕'} | ${birthChart.birthtime || 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕'} | ${birthChart.latitude || 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕'}, ${birthChart.longitude || 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕'}

ЁЯОп р╕Фр╕▓р╕зр╣Бр╕лр╣Ир╕Зр╕Др╕зр╕▓р╕бр╕кр╕│р╣Ар╕гр╣Зр╕И : [р╕Фр╕▓р╕з/р╕Ир╕╕р╕Ф]
ЁЯТа р╕Ир╕╕р╕Фр╣Ар╕Фр╣Ир╕Щ : [р╣Ар╕гр╕╖р╕нр╕Щ + р╕бр╕╕р╕бр╕кр╕Щр╕▒р╕Ър╕кр╕Щр╕╕р╕Щ]
ЁЯТб р╕Др╕│р╣Бр╕Щр╕░р╕Щр╕│р╣Ар╕Йр╕Юр╕▓р╕░р╕Хр╕▒р╕з : [р╕кр╣Др╕Хр╕ер╣Мр╕Др╕зр╕▓р╕бр╕кр╕│р╣Ар╕гр╣Зр╕Ир╕Чр╕╡р╣Ир╣Ар╕лр╕бр╕▓р╕░р╕кр╕бр╕Бр╕▒р╕Ър╕Фр╕▓р╕зр╕Щр╕╡р╣Й]

ЁЯУЕ р╣Ар╕лр╕Хр╕╕р╕Бр╕▓р╕гр╕Ур╣М : [р╕зр╕▒р╕Щ-р╣Ар╕зр╕ер╕▓ | Lat, Lon]
ЁЯУИ Success-Score : [xx / 100] тЬЕ(тЙе80) / ЁЯЪл(<80)
ЁЯкР р╕Фр╕▓р╕зр╕Ир╕гр╣Ар╕Фр╣Ир╕Щ :
  тАУ [р╕Фр╕▓р╕зр╕Ир╕г + р╕бр╕╕р╕б + р╕нр╕Зр╕ир╕▓]
  тАУ [...]

ЁЯУМ р╕кр╕гр╕╕р╕Ыр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М
  тАв **р╕ар╕▓р╕Юр╕гр╕зр╕бр╕Юр╕ер╕▒р╕Зр╕Фр╕▓р╕зр╕Ир╕г** : [р╕кр╕гр╕╕р╕Ыр╕кр╕▒р╣Йр╕Щ р╣Ж]
  тАв **р╣Вр╕Чр╕Щр╕кр╕╡-р╕Бр╕▓р╕гр╣Бр╕Хр╣Ир╕Зр╕Хр╕▒р╕з** : [р╕кр╕╡/р╕кр╣Др╕Хр╕ер╣Мр╕Чр╕╡р╣Ир╣Ар╕Бр╕╖р╣Йр╕нр╕лр╕Щр╕╕р╕Щр╕Фр╕▓р╕зр╣Ар╕Фр╣Ир╕Щ р╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕Юр╕┤р╣Ир╕бр╕Др╕зр╕▓р╕бр╕бр╕▒р╣Ир╕Щр╣Гр╕И]
  тАв **р╕лр╕ер╕▒р╕Бр╕Бр╕▓р╕гр╣Ар╕Ир╕гр╕Ир╕▓** : [р╣Бр╕Щр╕зр╕Чр╕▓р╕Зр╕кр╕╖р╣Ир╕нр╕кр╕▓р╕гр╕Чр╕╡р╣Ир╣Ар╕Вр╣Йр╕▓р╕Бр╕▒р╕Ър╕Юр╕ер╕▒р╕Зр╕Фр╕▓р╕з р╣Ар╕Кр╣Ир╕Щ р╣Гр╕Кр╣Йр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Кр╕┤р╕Зр╣Ар╕лр╕Хр╕╕р╕Ьр╕е, р╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕гр╕гр╕вр╕▓р╕Бр╕▓р╕ир╣Ар╕Ыр╣Зр╕Щр╕бр╕┤р╕Хр╕г]
  тАв **р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕гр╕░р╕зр╕▒р╕З** : [р╕нр╕╕р╕Ыр╕кр╕гр╕гр╕Др╕лр╕гр╕╖р╕нр╕Др╕зр╕▓р╕бр╕Хр╕╢р╕Зр╣Ар╕Др╕гр╕╡р╕вр╕Фр╕Ир╕▓р╕Бр╕бр╕╕р╕бр╕ер╕Ъ р╕Юр╕гр╣Йр╕нр╕бр╕зр╕┤р╕Шр╕╡р╕Ьр╣Ир╕нр╕Щр╕лр╕Щр╕▒р╕Бр╣Ар╕Ыр╣Зр╕Щр╣Ар╕Ър╕▓]
  тАв **р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╣Вр╕вр╕Зр╕Фр╕зр╕Зр╕Бр╕│р╣Ар╕Щр╕┤р╕Ф** : [р╕нр╕Шр╕┤р╕Ър╕▓р╕вр╕зр╣Ир╕▓ Success-Score р╣Бр╕ер╕░р╕Др╕│р╣Бр╕Щр╕░р╕Щр╕│р╕кр╕нр╕Фр╕Др╕ер╣Йр╕нр╕Зр╕Бр╕▒р╕Ър╕Юр╕╖р╣Йр╕Щр╕Фр╕зр╕Зр╕нр╕вр╣Ир╕▓р╕Зр╣Др╕г]
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА


тнРя╕П р╕Вр╣Йр╕нр╕Бр╕│р╕лр╕Щр╕Фр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б
р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕Хр╕▓р╕бр╕лр╕ер╕▒р╕Бр╣Вр╕лр╕гр╕▓р╕ир╕▓р╕кр╕Хр╕гр╣Мр╕кр╕▓р╕Бр╕е 100 % (р╣Др╕бр╣Ир╣Гр╕Кр╣Йр╕Бр╕▓р╕гр╣Ар╕Фр╕▓р╕кр╕╕р╣Ир╕бр╕лр╕гр╕╖р╕нр╣Др╕кр╕вр╕ир╕▓р╕кр╕Хр╕гр╣М)


р╕Хр╕нр╕Ър╕Бр╕ер╕▒р╕Ър╣Ар╕Ыр╣Зр╕Щр╕ар╕▓р╕йр╕▓р╣Др╕Чр╕вр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф


р╕лр╕▓р╕Б Success-Score < 80 р╣Гр╕лр╣Йр╣Ар╕кр╕Щр╕нр╕зр╕┤р╕Шр╕╡р╣Ар╕ер╕╖р╣Ир╕нр╕Щр╕зр╕▒р╕Щ-р╣Ар╕зр╕ер╕▓р╕лр╕гр╕╖р╕нр╕Ыр╕гр╕▒р╕Ър╕Бр╕ер╕вр╕╕р╕Чр╕Шр╣М (р╣Ар╕Кр╣Ир╕Щ р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕кр╕Цр╕▓р╕Щр╕Чр╕╡р╣Ир╕Ыр╕гр╕░р╕Кр╕╕р╕б р╕лр╕гр╕╖р╕нр╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Юр╕┤р╣Ир╕б)


р╕лр╕▓р╕Б Success-Score тЙд 20 р╣Ар╕Хр╕╖р╕нр╕Щр╕Кр╕▒р╕Фр╣Ар╕Ир╕Щр╕зр╣Ир╕▓ тАЬр╕Кр╣Ир╕зр╕Зр╕Щр╕╡р╣Йр╕Др╕зр╕гр╕лр╕ер╕╡р╕Бр╣Ар╕ер╕╡р╣Ир╕вр╕Зр╕Бр╕▓р╕гр╕Хр╕▒р╕Фр╕кр╕┤р╕Щр╣Гр╕Ир╕кр╕│р╕Др╕▒р╕НтАЭ

`;

const systemPrompt4 = ` Birth Chart Data:
${JSON.stringify(birthChart, null, 2)}

р╕лр╕бр╕зр╕Фр╣Вр╕Кр╕Др╕ер╕▓р╕ар╕Чр╕╡р╣Ир╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Ар╕ер╕╖р╕нр╕Б: ${category}
тЪЩя╕П WORKFLOW р╕вр╣Йр╕▓р╕вр╕Ър╣Йр╕▓р╕Щ/р╕вр╣Йр╕▓р╕вр╕Зр╕▓р╕Щ


ЁЯФ╣ р╕Вр╕▒р╣Йр╕Щр╕Чр╕╡р╣И 1 : р╕лр╕▓ тАЬр╕Фр╕▓р╕зр╣Бр╕лр╣Ир╕Зр╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕лр╕ер╕▒р╕БтАЭ (Planet of Relocation)
р╣Ар╕Бр╕Ур╕Ср╣М
р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╕вр╣Ир╕н
р╣Ар╕гр╕╖р╕нр╕Щр╕кр╕│р╕Др╕▒р╕Н
р╕Юр╕┤р╕Ир╕▓р╕гр╕Ур╕▓р╕Фр╕▓р╕з/р╕Ир╕╕р╕Фр╕Чр╕╡р╣Ир╕кр╕Цр╕┤р╕Хр╣Гр╕Щр╣Ар╕гр╕╖р╕нр╕Щ 2 (р╕Чр╕гр╕▒р╕Юр╕вр╣Мр╕кр╕┤р╕Щ) , 4 (р╕Ър╣Йр╕▓р╕Щ/р╕гр╕▓р╕Бр╕Рр╕▓р╕Щ) , 6 (р╕кр╕ар╕▓р╕Юр╣Бр╕зр╕Фр╕ер╣Йр╕нр╕бр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ) р╕лр╕гр╕╖р╕н 10 (р╕нр╕▓р╕Кр╕╡р╕Ю-р╕Кр╕╖р╣Ир╕нр╣Ар╕кр╕╡р╕вр╕З)
Ruler
р╕Фр╕▓р╕зр╕Чр╕╡р╣Ир╣Ар╕Ыр╣Зр╕Щр╣Ар╕Ир╣Йр╕▓р╕гр╕▓р╕ир╕╡р╕Вр╕нр╕Зр╣Ар╕гр╕╖р╕нр╕Щ 4 р╣Бр╕ер╕░ 10 (р╣Вр╕вр╕Зр╕Ър╣Йр╕▓р╕Щ-р╕Зр╕▓р╕Щ)
р╕бр╕╕р╕бр╕кр╕Щр╕▒р╕Ър╕кр╕Щр╕╕р╕Щ (┬▒3┬░)
Conjunct / Trine / Sextile р╕Бр╕▒р╕Ъ Sun, Jupiter, Venus, Saturn, IC р╕лр╕гр╕╖р╕н MC
р╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╣Ар╕Бр╕╡р╕вр╕гр╕Хр╕┤ (dignity)
р╕нр╕вр╕╣р╣Ир╣Гр╕Щ domicile р╕лр╕гр╕╖р╕н exaltation
р╕бр╕╕р╕бр╕Вр╕▒р╕Фр╣Бр╕вр╣Йр╕З (р╕Др╕зр╕гр╕лр╕ер╕╡р╕Бр╣Ар╕ер╕╡р╣Ир╕вр╕З)
Square / Opposition р╕Ир╕▓р╕Б Mars (р╕Др╕зр╕▓р╕бр╕зр╕╕р╣Ир╕Щр╕зр╕▓р╕в), Uranus (р╣Др╕бр╣Ир╣Бр╕Щр╣Ир╕Щр╕нр╕Щ), Neptune (р╕кр╕▒р╕Ър╕кр╕Щ)

р╣Ар╕ер╕╖р╕нр╕Бр╕Фр╕▓р╕з/р╕Ир╕╕р╕Фр╕Чр╕╡р╣Ир╣Ар╕Вр╣Йр╕▓р╣Ар╕Зр╕╖р╣Ир╕нр╕Щр╣Др╕Вр╕Ър╕зр╕Бр╕бр╕▓р╕Бр╕Чр╕╡р╣Ир╕кр╕╕р╕Ф тЖТ р╕Фр╕▓р╕зр╣Бр╕лр╣Ир╕Зр╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕лр╕ер╕▒р╕Б р╕Юр╕гр╣Йр╕нр╕бр╕нр╕Шр╕┤р╕Ър╕▓р╕вр╣Ар╕лр╕Хр╕╕р╕Ьр╕е

ЁЯФ╣ р╕Вр╕▒р╣Йр╕Щр╕Чр╕╡р╣И 2 : р╕Др╕│р╕Щр╕зр╕У Move-Score р╕Ир╕▓р╕Бр╕Фр╕▓р╕зр╕Ир╕г (Transit)
р╣Гр╕Кр╣Йр╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╕Фр╕▓р╕зр╕Ир╕г р╕У р╕зр╕▒р╕Щ-р╣Ар╕зр╕ер╕▓-р╕Юр╕┤р╕Бр╕▒р╕Ф тАЬр╣Ар╕лр╕Хр╕╕р╕Бр╕▓р╕гр╕Ур╣Мр╣Вр╕вр╕Бр╕вр╣Йр╕▓р╕втАЭ


р╕Хр╕гр╕зр╕Ир╕бр╕╕р╕б (orb ┬▒1┬░) р╕гр╕░р╕лр╕зр╣Ир╕▓р╕З р╕Фр╕▓р╕зр╕Ир╕г р╕Бр╕▒р╕Ъ р╕Фр╕▓р╕зр╕Бр╕│р╣Ар╕Щр╕┤р╕Фр╕лр╕ер╕▒р╕Б
 тАУ Sun, Moon, Mercury, Venus, Mars, Jupiter, Saturn, Uranus, Neptune, Pluto
 тАУ Part of Fortune, ASC, MC, IC


р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щр╕бр╕╕р╕б

р╕Хр╕▓р╕гр╕▓р╕Зр╕Щр╕╡р╣Йр╣Бр╕кр╕Фр╕Зр╕Др╕░р╣Бр╕Щр╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕бр╕╕р╕бр╕Хр╣Ир╕▓р╕Зр╣Ж:
Conjunction: +40
Trine: +30
Sextile: +20
Square: -30
Opposition: -40

р╕бр╕╕р╕бр╕Бр╕▒р╕Ъ ASC/MC/IC р╕Др╕┤р╕Фр╕Др╕░р╣Бр╕Щр╕Щр╕Фр╣Йр╕зр╕вр╕гр╕░р╕Ър╕Ър╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ
р╕гр╕зр╕бр╕Др╕░р╣Бр╕Щр╕Щ тЖТ р╕гр╕╡р╕кр╣Ар╕Бр╕е 0 тАУ 100 (р╕Цр╣Йр╕▓р╕гр╕зр╕б < 0 р╕Хр╕▒р╣Йр╕Зр╣Ар╕Ыр╣Зр╕Щ 0)



ЁЯФ╣ р╕Вр╕▒р╣Йр╕Щр╕Чр╕╡р╣И 3 : р╕кр╕гр╣Йр╕▓р╕Зр╕гр╕▓р╕вр╕Зр╕▓р╕Щ
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
ЁЯФО р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й : ${birthChart.name || 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕'}  
ЁЯУН р╕зр╕▒р╕Щр╣Ар╕Бр╕┤р╕Ф | р╣Ар╕зр╕ер╕▓р╣Ар╕Бр╕┤р╕Ф | р╕Юр╕┤р╕Бр╕▒р╕Фр╣Ар╕Бр╕┤р╕Ф : ${birthChart.birthdate || 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕'} | ${birthChart.birthtime || 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕'} | ${birthChart.latitude || 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕'}, ${birthChart.longitude || 'р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕'}


ЁЯПа р╕Фр╕▓р╕зр╣Бр╕лр╣Ир╕Зр╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕лр╕ер╕▒р╕Б : [р╕Фр╕▓р╕з/р╕Ир╕╕р╕Ф]
ЁЯТа р╕Ир╕╕р╕Фр╣Ар╕Фр╣Ир╕Щ : [р╣Ар╕гр╕╖р╕нр╕Щ + р╕бр╕╕р╕бр╕кр╣Ир╕Зр╣Ар╕кр╕гр╕┤р╕б]
ЁЯТб р╣Ар╕Др╕ер╣Зр╕Фр╕ер╕▒р╕Ър╣Ар╕Йр╕Юр╕▓р╕░р╕Хр╕▒р╕з : [р╣Бр╕Щр╕зр╕Чр╕▓р╕Зр╕кр╕гр╣Йр╕▓р╕Зр╕Др╕зр╕▓р╕бр╕бр╕▒р╣Ир╕Щр╕Др╕Зр╕Чр╕╡р╣Ир╣Ар╕Вр╣Йр╕▓р╕Бр╕▒р╕Ър╕Фр╕▓р╕зр╕Щр╕╡р╣Й]


ЁЯУЕ р╣Ар╕лр╕Хр╕╕р╕Бр╕▓р╕гр╕Ур╣Мр╣Вр╕вр╕Бр╕вр╣Йр╕▓р╕в : [р╕зр╕▒р╕Щ-р╣Ар╕зр╕ер╕▓ | Lat, Lon]
ЁЯУИ Move-Score : [xx / 100] тЬЕ(тЙе80) / ЁЯЪл(<80)
ЁЯкР р╕Фр╕▓р╕зр╕Ир╕гр╣Ар╕Фр╣Ир╕Щ :
  тАУ [р╕Фр╕▓р╕зр╕Ир╕г + р╕бр╕╕р╕б + р╕нр╕Зр╕ир╕▓]
  тАУ [...]


ЁЯУМ р╕кр╕гр╕╕р╕Ыр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М
  тАв **р╕ар╕▓р╕Юр╕гр╕зр╕бр╕Юр╕ер╕▒р╕Зр╕Фр╕▓р╕зр╕Ир╕г** : [р╕кр╕гр╕╕р╕Ыр╕Ър╕гр╕гр╕вр╕▓р╕Бр╕▓р╕ир╕Бр╕▓р╕гр╕вр╣Йр╕▓р╕в-р╣Ар╕Ыр╕┤р╕Фр╕нр╕нр╕Яр╕Яр╕┤р╕и]  
  тАв **р╣Вр╕Чр╕Щр╕кр╕╡-р╕Бр╕▓р╕гр╣Бр╕Хр╣Ир╕Зр╕Хр╕▒р╕з** : [р╕кр╕╡/р╕кр╣Др╕Хр╕ер╣Мр╕Чр╕╡р╣Ир╕Кр╣Ир╕зр╕вр╣Ар╕кр╕гр╕┤р╕бр╕Др╕зр╕▓р╕бр╕гр╕╣р╣Йр╕кр╕╢р╕Бр╕бр╕▒р╣Ир╕Щр╕Др╕Зр╣Бр╕ер╕░р╣Ар╕Ыр╣Зр╕Щр╕бр╕┤р╕Хр╕г]  
  тАв **р╣Бр╕Щр╕зр╕Чр╕▓р╕Зр╕кр╕╖р╣Ир╕нр╕кр╕▓р╕г-р╕Ир╕▒р╕Фр╕Бр╕▓р╕г** : [р╕зр╕┤р╕Шр╕╡р╣Ар╕Ир╕гр╕Ир╕▓, р╕Бр╕▓р╕гр╣Бр╕Ър╣Ир╕Зр╕Зр╕▓р╕Щ, р╕лр╕гр╕╖р╕нр╕Юр╕┤р╕Шр╕╡р╣Ар╕Ыр╕┤р╕Фр╣Гр╕лр╣Йр╕гр╕▓р╕Ър╕гр╕╖р╣Ир╕Щ]  
  тАв **р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕гр╕░р╕зр╕▒р╕З** : [р╕нр╕╕р╕Ыр╕кр╕гр╕гр╕Д р╣Ар╕Кр╣Ир╕Щ р╣Ар╕нр╕Бр╕кр╕▓р╕гр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф, р╕Фр╕╡р╣Ар╕ер╕вр╣М р╕Юр╕гр╣Йр╕нр╕бр╕зр╕┤р╕Шр╕╡р╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щ]  
  тАв **р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╣Вр╕вр╕Зр╕Фр╕зр╕Зр╕Бр╕│р╣Ар╕Щр╕┤р╕Ф** : [р╕нр╕Шр╕┤р╕Ър╕▓р╕вр╕зр╣Ир╕▓ Move-Score р╣Бр╕ер╕░р╕Др╕│р╣Бр╕Щр╕░р╕Щр╕│р╕кр╕нр╕Фр╕Др╕ер╣Йр╕нр╕Зр╕Бр╕▒р╕Ър╕Юр╕╖р╣Йр╕Щр╕Фр╕зр╕Зр╕нр╕вр╣Ир╕▓р╕Зр╣Др╕г]  
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА


тнРя╕П р╕Вр╣Йр╕нр╕Бр╕│р╕лр╕Щр╕Фр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б
р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕Хр╕▓р╕б р╕лр╕ер╕▒р╕Бр╣Вр╕лр╕гр╕▓р╕ир╕▓р╕кр╕Хр╕гр╣Мр╕кр╕▓р╕Бр╕е 100 % (р╣Др╕бр╣Ир╣Ар╕Фр╕▓р╕кр╕╕р╣Ир╕б, р╣Др╕бр╣Ир╣Гр╕Кр╣Йр╣Др╕кр╕вр╕ир╕▓р╕кр╕Хр╕гр╣М)


р╕Хр╕нр╕Ър╕Бр╕ер╕▒р╕Ъ р╣Ар╕Ыр╣Зр╕Щр╕ар╕▓р╕йр╕▓р╣Др╕Чр╕вр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф


р╕лр╕▓р╕Б Move-Score < 80 р╣Гр╕лр╣Йр╣Ар╕кр╕Щр╕нр╕Чр╕▓р╕Зр╣Ар╕ер╕╖р╕нр╕Бр╣Ар╕ер╕╖р╣Ир╕нр╕Щр╕зр╕▒р╕Щ-р╣Ар╕зр╕ер╕▓ р╕лр╕гр╕╖р╕нр╕Ыр╕гр╕▒р╕Ър╣Бр╕Ьр╕Щ (р╣Ар╕Кр╣Ир╕Щ р╕вр╣Йр╕▓р╕вр╕Юр╕┤р╕Шр╕╡р╣Ар╕Лр╣Зр╕Щр╕кр╕▒р╕Нр╕Нр╕▓р╣Др╕Ыр╕Кр╣Ир╕зр╕Зр╕Фр╕▓р╕зр╕кр╣Ир╕Зр╣Ар╕кр╕гр╕┤р╕б)


р╕лр╕▓р╕Б Move-Score тЙд 20 р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕Кр╕▒р╕Фр╣Ар╕Ир╕Щр╕зр╣Ир╕▓ тАЬр╕Кр╣Ир╕зр╕Зр╕Щр╕╡р╣Йр╕Др╕зр╕гр╣Ар╕ер╕╖р╣Ир╕нр╕Щр╕Бр╕▓р╕гр╣Вр╕вр╕Бр╕вр╣Йр╕▓р╕вр╕лр╕гр╕╖р╕нр╣Ар╕Ыр╕┤р╕Фр╕нр╕нр╕Яр╕Яр╕┤р╕ир╕кр╕│р╕Др╕▒р╕НтАЭ
`



  console.log("systemPrompt1",systemPrompt1)

   // - ЁЯОп **4 р╕лр╕бр╕зр╕Фр╣Вр╕Кр╕Др╕ер╕▓р╕а**: р╕Лр╕╖р╣Йр╕нр╕лр╕зр╕в, р╕Юр╕Ър╕гр╕▒р╕Б, р╕Фр╕зр╕Зр╕Шр╕╕р╕гр╕Бр╕┤р╕И, р╕вр╣Йр╕▓р╕вр╕Зр╕▓р╕Щ
  switch (category) {
    case "р╕Лр╕╖р╣Йр╕нр╕лр╕зр╕в":
      return systemPrompt1;
    case "р╕Юр╕Ър╕гр╕▒р╕Б":
      return systemPrompt2
    case "р╕Фр╕зр╕Зр╕Шр╕╕р╕гр╕Бр╕┤р╕И":
      return systemPrompt3
    case "р╕вр╣Йр╕▓р╕вр╕Зр╕▓р╕Щ":
      return systemPrompt4
    default:
      return systemPrompt_old;
  }

  }

  async getFortuneFromOpenAI(birthChart, category) {
    try {
      const systemPrompt = this.generateSystemPrompt(birthChart, category);

      const content = `р╕Бр╕гр╕╕р╕Ур╕▓р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╣Вр╕Кр╕Др╕ер╕▓р╕ар╕лр╕бр╕зр╕Ф "${category}" р╕Ир╕▓р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е Birth Chart р╕Чр╕╡р╣Ир╣Гр╕лр╣Йр╕бр╕▓ р╣Бр╕ер╕░р╕Хр╕нр╕Ър╕Хр╕▓р╕б RESPONSE FORMAT р╕Чр╕╡р╣Ир╕Бр╕│р╕лр╕Щр╕Фр╕нр╕вр╣Ир╕▓р╕Зр╣Ар╕Др╕гр╣Ир╕Зр╕Др╕гр╕▒р╕Ф`;

      console.log("systemPrompt",systemPrompt)

      console.log("content",content)
      
      const completion = await this.openai.chat.completions.create({
        model: "gpt-4o-mini",
        messages: [
          {
            role: "system",
            content: systemPrompt
          },
          {
            role: "user", 
            content: content
          }
        ],
        max_tokens: 1500,
        temperature: 0.7
      });

      console.log("completion.choices[0].message.content",completion.choices[0].message.content)

      return completion.choices[0].message.content;
    } catch (error) {
      console.error('OpenAI API error:', error);
      throw error;
    }
  }

  async getFortuneFromClaude(birthChart, category) {
    try {
      const systemPrompt = this.generateSystemPrompt(birthChart, category);
      
      const response = await this.anthropic.messages.create({
        model: "claude-3-5-haiku-20241022",
        max_tokens: 1500,
        system: systemPrompt,
        messages: [
          {
            role: "user",
            content: `р╕Бр╕гр╕╕р╕Ур╕▓р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╣Вр╕Кр╕Др╕ер╕▓р╕ар╕лр╕бр╕зр╕Ф "${category}" р╕Ир╕▓р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е Birth Chart р╕Чр╕╡р╣Ир╣Гр╕лр╣Йр╕бр╕▓ р╣Бр╕ер╕░р╕Хр╕нр╕Ър╕Хр╕▓р╕б RESPONSE FORMAT р╕Чр╕╡р╣Ир╕Бр╕│р╕лр╕Щр╕Фр╕нр╕вр╣Ир╕▓р╕Зр╣Ар╕Др╕гр╣Ир╕Зр╕Др╕гр╕▒р╕Ф`
          }
        ]
      });

      return response.content[0].text;
    } catch (error) {
      console.error('Claude API error:', error);
      throw error;
    }
  }

  async getFortuneFromOllama(birthChart, category) {
    try {
      const systemPrompt = this.generateSystemPrompt(birthChart, category);
      const userContent = `р╕Бр╕гр╕╕р╕Ур╕▓р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╣Вр╕Кр╕Др╕ер╕▓р╕ар╕лр╕бр╕зр╕Ф "${category}" р╕Ир╕▓р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е Birth Chart р╕Чр╕╡р╣Ир╣Гр╕лр╣Йр╕бр╕▓ р╣Бр╕ер╕░р╕Хр╕нр╕Ър╕Хр╕▓р╕б RESPONSE FORMAT р╕Чр╕╡р╣Ир╕Бр╕│р╕лр╕Щр╕Фр╕нр╕вр╣Ир╕▓р╕Зр╣Ар╕Др╕гр╣Ир╕Зр╕Др╕гр╕▒р╕Ф`;
      
      const response = await this.ollama.chat({
        model: config.ai.ollamaModel,
        messages: [
          {
            role: 'system',
            content: systemPrompt
          },
          {
            role: 'user',
            content: userContent
          }
        ],
        stream: false
      });

      console.log('Ollama response:', response.message.content);
      return response.message.content;
    } catch (error) {
      console.error('Ollama API error:', error);
      throw error;
    }
  }

  async getFortune(birthChart, category, preferredProvider = 'chatgpt') {
    try {
      if (preferredProvider === 'ollama') {
        return await this.getFortuneFromOllama(birthChart, category);
      } else if (preferredProvider === 'claude' && config.ai.anthropicApiKey) {
        return await this.getFortuneFromClaude(birthChart, category);
      } else if (config.ai.openaiApiKey) {
        return await this.getFortuneFromOpenAI(birthChart, category);
      } else {
        throw new Error('No AI API key configured');
      }
    } catch (error) {
      console.error('AI Service error:', error);
      return this.getFallbackResponse(category);
    }
  }

  getFallbackResponse(category) {
    const fallbackResponses = {
      'р╕Лр╕╖р╣Йр╕нр╕лр╕зр╕в': `
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
**р╕Кр╣Ир╕зр╕Зр╣Ар╕зр╕ер╕▓** : ${new Date().toLocaleDateString('th-TH')} ${new Date().toLocaleTimeString('th-TH')}
**Lucky-Score** : xx / 100  тЭМ р╕Хр╣Ир╕│р╕Бр╕зр╣Ир╕▓р╣Ар╕Бр╕Ур╕Ср╣М  
**р╕Фр╕▓р╕зр╕Ир╕гр╣Ар╕Фр╣Ир╕Щ** : р╣Др╕бр╣Ир╕бр╕╡р╕Фр╕▓р╕зр╕Ир╕гр╣Гр╕лр╣Йр╕Юр╕ер╕▒р╕Зр╕Ър╕зр╕Бр╣Ар╕Юр╕╡р╕вр╕Зр╕Юр╕н
**р╣Ар╕ер╕Вр╣Ар╕Фр╣Зр╕Ф** : р╣Др╕бр╣Ир╣Бр╕Щр╕░р╕Щр╕│р╣Гр╕Щр╕Кр╣Ир╕зр╕Зр╕Щр╕╡р╣Й
**р╕Др╣Нр╕▓р╣Бр╕Щр╕░р╕Щр╣Нр╕▓** : р╕Кр╣Ир╕зр╕Зр╕Щр╕╡р╣Йр╕Фр╕зр╕Зр╣Ар╕кр╕╡р╣Ир╕вр╕Зр╣Вр╕Кр╕Др╕вр╕▒р╕Зр╕Хр╣Ир╕│ р╣Др╕бр╣Ир╣Бр╕Щр╕░р╕Щр╕│р╕Бр╕▓р╕гр╕Лр╕╖р╣Йр╕нр╕лр╕зр╕в р╕Др╕зр╕гр╕гр╕нр╕Кр╣Ир╕зр╕Зр╕Чр╕╡р╣Ир╕Фр╕▓р╕зр╣Вр╕Кр╕Др╕ер╕▓р╕а (Jupiter) р╕нр╕вр╕╣р╣Ир╣Гр╕Щр╕бр╕╕р╕бр╕Фр╕╡р╕Бр╕▒р╕Ър╕Фр╕зр╕Зр╕Бр╕│р╣Ар╕Щр╕┤р╕Ф
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА`,
      
      'р╕Юр╕Ър╕гр╕▒р╕Б': `
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
**р╕Кр╣Ир╕зр╕Зр╣Ар╕зр╕ер╕▓** : ${new Date().toLocaleDateString('th-TH')} ${new Date().toLocaleTimeString('th-TH')}
**Lucky-Score** : xx / 100  тЭМ р╕Хр╣Ир╕│р╕Бр╕зр╣Ир╕▓р╣Ар╕Бр╕Ур╕Ср╣М  
**р╕Фр╕▓р╕зр╕Ир╕гр╣Ар╕Фр╣Ир╕Щ** : р╕Фр╕▓р╕зр╕ир╕╕р╕Бр╕гр╣Мр╕вр╕▒р╕Зр╣Др╕бр╣Ир╕нр╕вр╕╣р╣Ир╣Гр╕Щр╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╕Чр╕╡р╣Ир╣Ар╕лр╕бр╕▓р╕░р╕кр╕б
**р╣Ар╕ер╕Вр╣Ар╕Фр╣Зр╕Ф** : р╣Др╕бр╣Ир╣Бр╕Щр╕░р╕Щр╕│р╣Гр╕Щр╕Кр╣Ир╕зр╕Зр╕Щр╕╡р╣Й
**р╕Др╣Нр╕▓р╣Бр╕Щр╕░р╕Щр╣Нр╕▓** : р╕Кр╣Ир╕зр╕Зр╕Щр╕╡р╣Йр╣Ар╕гр╕╖р╣Ир╕нр╕Зр╕Др╕зр╕▓р╕бр╕гр╕▒р╕Бр╕вр╕▒р╕Зр╣Др╕бр╣Ир╣Ар╕Вр╣Йр╕▓р╕Чр╣Ир╕▓ р╕Др╕зр╕гр╕Юр╕▒р╕Тр╕Щр╕▓р╕Хр╕▒р╕зр╣Ар╕нр╕Зр╣Бр╕ер╕░р╕гр╕нр╕Кр╣Ир╕зр╕Зр╕Чр╕╡р╣Ир╕Фр╕▓р╕зр╕ир╕╕р╕Бр╕гр╣М (Venus) р╕кр╣Ир╕нр╕Зр╣Бр╕кр╕Зр╕Фр╕╡
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА`,
      
      'р╕Фр╕зр╕Зр╕Шр╕╕р╕гр╕Бр╕┤р╕И': `
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
**р╕Кр╣Ир╕зр╕Зр╣Ар╕зр╕ер╕▓** : ${new Date().toLocaleDateString('th-TH')} ${new Date().toLocaleTimeString('th-TH')}
**Lucky-Score** : xx / 100  тЭМ р╕Хр╣Ир╕│р╕Бр╕зр╣Ир╕▓р╣Ар╕Бр╕Ур╕Ср╣М  
**р╕Фр╕▓р╕зр╕Ир╕гр╣Ар╕Фр╣Ир╕Щ** : р╕Фр╕▓р╕зр╕нр╕▒р╕Зр╕Др╕▓р╕гр╣Бр╕ер╕░р╕Фр╕▓р╕зр╕Юр╕╕р╕Шр╕вр╕▒р╕Зр╣Др╕бр╣Ир╣Ар╕Вр╣Йр╕▓р╕Вр╕▓р╕Фр╕╡
**р╣Ар╕ер╕Вр╣Ар╕Фр╣Зр╕Ф** : р╣Др╕бр╣Ир╣Бр╕Щр╕░р╕Щр╕│р╣Гр╕Щр╕Кр╣Ир╕зр╕Зр╕Щр╕╡р╣Й
**р╕Др╣Нр╕▓р╣Бр╕Щр╕░р╕Щр╣Нр╕▓** : р╕Шр╕╕р╕гр╕Бр╕┤р╕Ир╕Др╕зр╕гр╕гр╕нр╕Кр╣Ир╕зр╕Зр╕Чр╕╡р╣Ир╣Ар╕лр╕бр╕▓р╕░р╕кр╕б р╕бр╕╕р╣Ир╕Зр╣Ар╕Щр╣Йр╕Щр╕Бр╕▓р╕гр╕зр╕▓р╕Зр╣Бр╕Ьр╕Щр╣Бр╕ер╕░р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Хр╕▒р╕з р╕гр╕нр╕Фр╕▓р╕зр╣Вр╕Кр╕Др╕ер╕▓р╕ар╣Ар╕Вр╣Йр╕▓р╕бр╕▓р╕Кр╣Ир╕зр╕в
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА`,
      
      'р╕вр╣Йр╕▓р╕вр╕Зр╕▓р╕Щ': `
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА
**р╕Кр╣Ир╕зр╕Зр╣Ар╕зр╕ер╕▓** : ${new Date().toLocaleDateString('th-TH')} ${new Date().toLocaleTimeString('th-TH')}
**Lucky-Score** : xx / 100  тЭМ р╕Хр╣Ир╕│р╕Бр╕зр╣Ир╕▓р╣Ар╕Бр╕Ур╕Ср╣М  
**р╕Фр╕▓р╕зр╕Ир╕гр╣Ар╕Фр╣Ир╕Щ** : р╕Фр╕▓р╕зр╣Ар╕кр╕▓р╕гр╣Мр╕вр╕▒р╕Зр╕кр╣Ир╕Зр╕Юр╕ер╕▒р╕Зр╕Хр╕┤р╕Фр╕Вр╕▒р╕Ф
**р╣Ар╕ер╕Вр╣Ар╕Фр╣Зр╕Ф** : р╣Др╕бр╣Ир╣Бр╕Щр╕░р╕Щр╕│р╣Гр╕Щр╕Кр╣Ир╕зр╕Зр╕Щр╕╡р╣Й
**р╕Др╣Нр╕▓р╣Бр╕Щр╕░р╕Щр╣Нр╕▓** : р╕Бр╕▓р╕гр╕вр╣Йр╕▓р╕вр╕Зр╕▓р╕Щр╕Др╕зр╕гр╕гр╕нр╕Кр╣Ир╕зр╕Зр╕Чр╕╡р╣Ир╣Ар╕лр╕бр╕▓р╕░р╕кр╕б р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щр╕Др╕зр╕гр╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╕Чр╕▒р╕Бр╕йр╕░р╣Бр╕ер╕░р╕гр╕нр╣Вр╕нр╕Бр╕▓р╕кр╕Чр╕╡р╣Ир╕Фр╕╡р╕Бр╕зр╣Ир╕▓
тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА`
    };

    return fallbackResponses[category] || fallbackResponses['р╕Лр╕╖р╣Йр╕нр╕лр╕зр╕в'];
  }
}

module.exports = new AIService();